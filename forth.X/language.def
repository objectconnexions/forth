_reset
noecho

0x0bf80f230 CONSTANT SYSKEY

0x0bf880000 CONSTANT IO
0x0bf886000 CONSTANT PORTA
0x0bf886100 CONSTANT PORTB
0x0bf886200 CONSTANT PORTC

0x00 CONSTANT ANSEL
0x10 CONSTANT TRIS
0x20 CONSTANT PORT

4 CONSTANT LED_COMM


: 0= ( n -- flag )
	0 =
;

: 0> ( n -- flag )
	0 >
;

: 0< ( n -- flag )
	0 > NOT
;

: 0<> ( n -- flag )
	0 = NOT
;

: 2DUP ( n1 n2 -- n1 n2 n1 n2 )
	over
	over
;


: SET_BITS ( value value position -- value )
	lshift or
;

\ clear bit at position in register
: BIT_CLR ( addr pos -- ) 
	1 swap lshift		\ determine mask
	swap 
	0x04 or				\ clear register is 4 registers on
	!					\ write to register
;

\ set bit at position in register
: BIT_SET ( addr pos -- ) 
	1 swap lshift		\ determine mask
	swap 
	0x08 or				\ set register is 8 registers on
	!					\ write to register
;

\ set bit at position in register
: BIT_INV ( addr pos -- ) 
	1 swap lshift		\ determine mask
	swap 
	0x0c or				\ set register is 12 registers on
	!					\ write to register
;

: BIT_READ ( addr pos -- val )
	swap @
	swap rshift
	0x01 and
;

: DIGITAL_IN ( port bit -- )
	swap
	2dup				\ copy params
	ANSEL +				\ determine ANSEL reg address
	swap bit_clr		\ clear analogue flag
	
	2dup
	TRIS +				\ TRIS register
	swap bit_set		\ set to input
;

: DIGITAL_OUT ( port bit -- )
	swap
	2dup				\ copy params
	ANSEL +				\ determine ANSEL reg address
	swap bit_clr		\ clear analogue flag
	
	2dup
	TRIS +				\ TRIS register
	swap bit_clr		\ set to output

	PORT +				\ PORT register
	swap bit_clr		\ set to off
;

: PORT_ON ( port bit -- )
	swap
	PORT +				\ PORT register
	swap bit_set		\ set to on
;

: PORT_OFF ( port bit -- )
	swap
	PORT +				\ PORT register
	swap bit_clr		\ set to on
;

: PORT_TOGGLE ( port bit -- )
	swap
	PORT +				\ PORT register
	swap bit_inv		\ set to on
;
 
: PORT_STATE ( port bit -- flag )
	swap
	PORT +
	swap bit_read
;

\ TODO add port state to read bit

echo

